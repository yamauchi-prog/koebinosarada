<!DOCTYPE html>
<html lang="jp">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›‘è«‡ç”»é¢</title>
    <!--<link rel="stylesheet" href="{{ url_for('static', filename='question_dblog.css') }}" >-->
</head>

<style>/*ã€Œé›‘è«‡ã™ã‚‹ã€ã«é–¢ã—ã¦ã¯ã“ã“ã‚’ç·¨é›†*/
    body {
        display: flex;
        justify-content: center;
        align-items: center;
            }

/* çµµæ–‡å­—ãƒœã‚¿ãƒ³ã®è¦ªè¦ç´ ã« Flexbox ã‚’é©ç”¨ã—ã¦å‡ç­‰ã«é…ç½®ã™ã‚‹ */
table tr:last-child {
    display: flex;
    justify-content: space-between; /* è¦ç´ é–“ã®é–“éš”ã‚’å‡ç­‰ã« */
}

/* å„çµµæ–‡å­—ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
button[id^="like-button"] {
    border: none; /* æ ã‚’å‰Šé™¤ */
    background: none; /* èƒŒæ™¯ã‚’é€æ˜ã« */
    cursor: pointer; /* ã‚«ãƒ¼ã‚½ãƒ«ã‚’ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã«è¨­å®š */
    padding: 0; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã«è¨­å®š */
    font-size: inherit; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’ç¶™æ‰¿ */
    flex: 1; /* å¹…ã‚’å‡ç­‰ã«ã™ã‚‹ */
    text-align: center; /* ãƒœã‚¿ãƒ³å†…ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¸­å¤®æƒãˆ */
}

/* çµµæ–‡å­—ã®ãƒœã‚¿ãƒ³ã‹ã‚‰æ ã‚’å‰Šé™¤ */
    button[id^="like-button"] 
    {
        border: none; /* æ ã‚’å‰Šé™¤ */
        background: none; /* èƒŒæ™¯ã‚’é€æ˜ã« */
        cursor: pointer; /* ã‚«ãƒ¼ã‚½ãƒ«ã‚’ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã«è¨­å®š */
        padding: 0; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã«è¨­å®š */
        font-size: inherit; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’ç¶™æ‰¿ */
    } 

    .db-footer {
        position: fixed;
        bottom: 0;
        width: 5%;
        /* background-color: #f0f0f0; ãƒ•ãƒƒã‚¿ãƒ¼ã®èƒŒæ™¯è‰² */
        background-color: #43C660;
        color: #000000;
        padding: 10px 20px; /* é©åˆ‡ãªä½™ç™½ã‚’è¿½åŠ  */
        margin-bottom:50px;/*ä¸‹ã«ä½™ç™½35pxã‚’å…¥ã‚Œã‚‹*/
        border-radius: 10px;
        text-decoration: none;
        left: 500px;
    }

</style>

<body>

    {% include 'header.html' %}

    <div style="height: 50px;"></div>


    <form id="select-content" method="post">
        <h2>å­¦éƒ¨é¸æŠ</h2> 
        <select name="faculty_r" class="form-select"> 
            <option value="æƒ…å ±å·¥å­¦éƒ¨æƒ…å ±å·¥å­¦ç§‘">
                æƒ…å ±å·¥å­¦éƒ¨æƒ…å ±å·¥å­¦ç§‘
            </option>
            <option value="éƒ½å¸‚æƒ…å ±å­¦éƒ¨éƒ½å¸‚æƒ…å ±å­¦ç§‘">
                éƒ½å¸‚æƒ…å ±å­¦éƒ¨éƒ½å¸‚æƒ…å ±å­¦ç§‘
            </option>
        </select>
        <div>
            <button type="submit" id="select_button">å­¦éƒ¨é¸æŠ</button>
        </div>

    </form>
    <div id="answer_text"></div>

    <script>

        const button = document.getElementById("select_button");
        const form = document.getElementById("select-content");
        const answerText = document.getElementById("answer_text");


form.addEventListener("submit", event => {
    // ãƒšãƒ¼ã‚¸ã‚’ç§»å‹•ã™ã‚‹å‡¦ç†ã‚’æŠ‘åˆ¶
    event.preventDefault();


    const faculty_r = form.faculty_r.value;
         // è³ªå•æ™‚ã®æƒ…å ±ã‚’JSONã«å¤‰æ›ã™ã‚‹
    const postData = {
        "faculty_r": faculty_r
    };

    // ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«å¯¾ã—ã¦å›ç­”ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    fetch("/dbselect", {
        method: "POST",
        headers: { "Content-Type": "application/json; charset=utf-8" },
        body: JSON.stringify(postData)
    })
    .then(response => {
        // å›ç­”ãƒ‡ãƒ¼ã‚¿ã‚’jsonå½¢å¼ã§å–å¾—
        return response.json();
    })
    .then(data => {
        // ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã«å›ç­”ãƒ‡ãƒ¼ã‚¿ã‚’åæ˜ 
        zatudan_log_data_list = data.zatudan_log_data_list; // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        console.log("zatudan_log_data_list"); // ãƒ‡ãƒãƒƒã‚°ç”¨
        console.log(zatudan_log_data_list);
        answerText.innerHTML = data.answer;

    })
    .finally(() => {
        // å›ç­”å®Œäº†ã‚’ãƒ­ã‚°ã«æ®‹ã™
        console.log("request complete!")
    });
});
    </script>

<div class="-wrapper">
        {% for zatudan_log_data in zatudan_log_data_list %}
        <!-- ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã§å›ç­”ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º -->
        <p>
            <table border="1">
                <tbody>
                    <tr>
                        <td rowspan="1" nowrap id="selectedImage"><img src='{{ zatudan_log_data["icon"] }}' width="25px"></td>
                        <td>{{ zatudan_log_data["date"] }}</td>
                        <td>{{ zatudan_log_data["faculty"] }}</td><!--å­¦éƒ¨-->
                    </tr>
                    <tr>
                        <td nowrap>è³ªå•å†…å®¹</td>
                        <td colspan="2">{{ zatudan_log_data["question"]|safe }}</td><!--è³ªå•å†…å®¹-->
                    </tr>
                    <tr>
                        <td>
                            <button id="like-button1-{{ zatudan_log_data['id'] }}">
                                ğŸ˜†{{ zatudan_log_data['like1'] }}
                            </button>
                        </td><!--ãƒœã‚¿ãƒ³1-->
                        <td>
                            <button id="like-button2-{{ zatudan_log_data['id'] }}">
                                ğŸ˜{{ zatudan_log_data['like2'] }}
                            </button>
                        </td><!--ãƒœã‚¿ãƒ³2-->
                        <td>
                            <button id="like-button3-{{ zatudan_log_data['id'] }}">
                                ğŸ˜­{{ zatudan_log_data['like3'] }}
                            </button>
                        </td><!--ãƒœã‚¿ãƒ³3-->
                        <td>
                            <button id="like-button4-{{ zatudan_log_data['id'] }}">
                                ğŸ˜¯{{ zatudan_log_data['like4'] }}
                            </button>
                        </td><!--ãƒœã‚¿ãƒ³4-->
                        <footer class="an-footer">
                            <td colspan="2">
                                <button style="float: right; margin-right: 5%;"><a href="{{ url_for('response') }}">è¿”ä¿¡</a></button></td><!--è¿”ä¿¡ãƒœã‚¿ãƒ³-->
                        </footer>
                    </tr>
                </tbody>
            </table>
        </p>

        <script>

            // ã€Œã„ã„ã­1ã€ãƒœã‚¿ãƒ³ã®elementã‚’å–å¾—
            document.getElementById("like-button1-{{ zatudan_log_data['id'] }}").
                addEventListener("click", ev => {
    
                    // ã€Œã„ã„ã­ã€ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
                    document.getElementById("like-button1-{{ zatudan_log_data['id'] }}").disabled = true;
    
                    // ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«ã€Œã„ã„ã­ã€ã®ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
                    fetch("zatulike1", {
                        method: "POST",
                        headers: { "Content-Type": "application/json; charset=utf-8" },
                        body: JSON.stringify({ "id": "{{ zatudan_log_data['id'] }}" })
                    })
                        .then(response => {
                            // ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—å¾Œã®ã€Œã„ã„ã­ã€ã‚’å–å¾—
                            return response.json();
                        })
                        .then(data => {
                            // ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—å¾Œã®ã€Œã„ã„ã­ã€ã‚’ã€Œã„ã„ã­ã€ãƒœã‚¿ãƒ³ã«åæ˜ 
                            document.getElementById("like-button1-{{ zatudan_log_data['id'] }}").innerHTML = 'ğŸ˜†' + data["result"];
                        }).finally(() => {
                            console.log("request complete!");
                        });
                });

                // ã€Œã„ã„ã­2ã€ãƒœã‚¿ãƒ³ã®elementã‚’å–å¾—
            document.getElementById("like-button2-{{ zatudan_log_data['id'] }}").
                addEventListener("click", ev => {
    
                    // ã€Œã„ã„ã­ã€ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
                    document.getElementById("like-button2-{{ zatudan_log_data['id'] }}").disabled = true;
    
                    // ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«ã€Œã„ã„ã­ã€ã®ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
                    fetch("zatulike2", {
                        method: "POST",
                        headers: { "Content-Type": "application/json; charset=utf-8" },
                        body: JSON.stringify({ "id": "{{ zatudan_log_data['id'] }}" })
                    })
                        .then(response => {
                            // ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—å¾Œã®ã€Œã„ã„ã­ã€ã‚’å–å¾—
                            return response.json();
                        })
                        .then(data => {
                            // ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—å¾Œã®ã€Œã„ã„ã­ã€ã‚’ã€Œã„ã„ã­ã€ãƒœã‚¿ãƒ³ã«åæ˜ 
                            document.getElementById("like-button2-{{ zatudan_log_data['id'] }}").innerHTML = 'ğŸ˜' + data["result"];
                        }).finally(() => {
                            console.log("request complete!");
                        });
                });

                 // ã€Œã„ã„ã­3ã€ãƒœã‚¿ãƒ³ã®elementã‚’å–å¾—
            document.getElementById("like-button3-{{ zatudan_log_data['id'] }}").
                addEventListener("click", ev => {
    
                    // ã€Œã„ã„ã­ã€ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
                    document.getElementById("like-button3-{{ zatudan_log_data['id'] }}").disabled = true;
    
                    // ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«ã€Œã„ã„ã­ã€ã®ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
                    fetch("zatulike3", {
                        method: "POST",
                        headers: { "Content-Type": "application/json; charset=utf-8" },
                        body: JSON.stringify({ "id": "{{ zatudan_log_data['id'] }}" })
                    })
                        .then(response => {
                            // ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—å¾Œã®ã€Œã„ã„ã­ã€ã‚’å–å¾—
                            return response.json();
                        })
                        .then(data => {
                            // ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—å¾Œã®ã€Œã„ã„ã­ã€ã‚’ã€Œã„ã„ã­ã€ãƒœã‚¿ãƒ³ã«åæ˜ 
                            document.getElementById("like-button3-{{ zatudan_log_data['id'] }}").innerHTML = ' ğŸ˜­' + data["result"];
                        }).finally(() => {
                            console.log("request complete!");
                        });
                });

                 // ã€Œã„ã„ã­4ã€ãƒœã‚¿ãƒ³ã®elementã‚’å–å¾—
            document.getElementById("like-button4-{{ zatudan_log_data['id'] }}").
                addEventListener("click", ev => {
    
                    // ã€Œã„ã„ã­ã€ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
                    document.getElementById("like-button4-{{ zatudan_log_data['id'] }}").disabled = true;
    
                    // ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«ã€Œã„ã„ã­ã€ã®ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
                    fetch("zatulike4", {
                        method: "POST",
                        headers: { "Content-Type": "application/json; charset=utf-8" },
                        body: JSON.stringify({ "id": "{{ zatudan_log_data['id'] }}" })
                    })
                        .then(response => {
                            // ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—å¾Œã®ã€Œã„ã„ã­ã€ã‚’å–å¾—
                            return response.json();
                        })
                        .then(data => {
                            // ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—å¾Œã®ã€Œã„ã„ã­ã€ã‚’ã€Œã„ã„ã­ã€ãƒœã‚¿ãƒ³ã«åæ˜ 
                            document.getElementById("like-button4-{{ zatudan_log_data['id'] }}").innerHTML = ' ğŸ˜¯' + data["result"];
                        }).finally(() => {
                            console.log("request complete!");
                        });
                });

        </script>
    
        {% endfor %}
</div>
<footer class="db-footer">
    <a href="{{ url_for('zatudan') }}" class="ask-question-btn">é›‘è«‡ã™ã‚‹</a>
</footer>
<div class="push"></div>


{% include 'footer.html' %}

</body>
</html>
<!DOCTYPE html>
<html lang="jp">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>雑談画面</title>
    <!--<link rel="stylesheet" href="{{ url_for('static', filename='question_dblog.css') }}" >-->
    <style>
        button {
            background-color:#B6B6B0;  
        }
/* スマートフォン画面用のスタイル */
        @media screen and (max-width: 480px) {
            td {
                width: auto; /* 幅の指定 */
                height: auto; /* 高さは自動調整 */
                white-space: normal; /* テキストの折り返しを許可 */
            }
        }
/* フッター内の質問するボタンのスタイル */
        .db-footer {
            position: fixed;
            bottom: 20px; /* 画面下からの距離を調整 */
        }

/* 質問するボタンの共通スタイル */
        .ask-question-btn {
            float: right; /* 右側に浮動 */
            margin-right: 20px; /* 画面右からの距離を調整 */ display: inline-block;
            padding: 10px 20px;
            border-radius: 5px;
            background-color: #43C660;
            color:#000000;
            text-decoration: none;
        }
/* パソコン向けのスタイル */
        @media (min-width: 768px) {
            .ask-question-btn {
                width:50%;
                margin:0 auto;
            }
        }

/* スマートフォン向けのスタイル */
        @media (max-width: 398px) {
            .ask-question-btn {
                text-align: center; /* ボタンを中央に配置 */
                margin: 20px auto; /* 上下左右に余白を持たせる */
                display: block; /* ボタンをブロック要素に変更 */
                float:right;
                margin-right:20px;
            }
        }

/* パソコン向けのスタイル */
        @media (min-width: 768px) {
            .table-wrapper {
                margin-left: auto;
                margin-right: auto;
                width: 100%; /* 必要に応じて幅を指定しま
            }

            .db-footer {
                text-align: center; /* フッター内の要素を中央に配置 */
            }
        }
    </style>
</head>

<style>/*「質問する」に関してはここを編集*/
    .db-footer {
    position: fixed;
    bottom: 0;
    width: 100%;
    /* background-color: #f0f0f0; フッターの背景色 */
    padding: 10px; /* 適切な余白を追加 */
    margin-bottom:35px;/*下に余白35pxを入れる*/
}
    .push{
        height: 80px;
    }
</style>

<body>

    {% include 'header.html' %}

    <div style="height: 50px;"></div>


    <form id="select-content" method="post">
        <h2>学部選択</h2> 
        <select name="faculty_r" class="form-select"> 
            <option value="情報工学部情報工学科">
                情報工学部情報工学科
            </option>
            <option value="都市情報学部都市情報学科">
                都市情報学部都市情報学科
            </option>
        </select>
        <div>
            <button type="submit" id="select_button">学部選択</button>
        </div>

    </form>
    <div id="answer_text"></div>

    <script>

        const button = document.getElementById("select_button");
        const form = document.getElementById("select-content");
        const answerText = document.getElementById("answer_text");


form.addEventListener("submit", event => {
    // ページを移動する処理を抑制
    event.preventDefault();


    const faculty_r = form.faculty_r.value;
         // 質問時の情報をJSONに変換する
    const postData = {
        "faculty_r": faculty_r
    };

    // バックエンドに対して回答データをリクエスト
    fetch("/dbselect", {
        method: "POST",
        headers: { "Content-Type": "application/json; charset=utf-8" },
        body: JSON.stringify(postData)
    })
    .then(response => {
        // 回答データをjson形式で取得
        return response.json();
    })
    .then(data => {
        // テキストボックスに回答データを反映
        zatudan_log_data_list = data.zatudan_log_data_list; // レスポンスからデータを取得
        console.log("zatudan_log_data_list"); // デバッグ用
        console.log(zatudan_log_data_list);
        answerText.innerHTML = data.answer;

    })
    .finally(() => {
        // 回答完了をログに残す
        console.log("request complete!")
    });
});
    </script>

<div class="-wrapper">
        {% for zatudan_log_data in zatudan_log_data_list %}
        <!-- テーブル形式で回答データを表示 -->
        <p>
            <table border="1">
                <tbody>
                    <tr>
                        <td rowspan="1" nowrap id="selectedImage"><img src='{{ zatudan_log_data["icon"] }}' width="25px"></td>
                        <td>{{ zatudan_log_data["date"] }}</td>
                        <td>{{ zatudan_log_data["faculty"] }}</td><!--学部-->
                    </tr>
                    <tr>
                        <td nowrap>質問内容</td>
                        <td colspan="2">{{ zatudan_log_data["question"]|safe }}</td><!--質問内容-->
                    </tr>
                    <tr>
                        <td>
                            <button id="like-button1-{{ zatudan_log_data['id'] }}">
                                (';'){{ zatudan_log_data['like1'] }}
                            </button>
                        </td><!--ボタン1-->
                        <td>
                            <button id="like-button2-{{ zatudan_log_data['id'] }}">
                                (';'){{ zatudan_log_data['like2'] }}
                            </button>
                        </td><!--ボタン2-->
                        <td>
                            <button id="like-button3-{{ zatudan_log_data['id'] }}">
                                (';'){{ zatudan_log_data['like3'] }}
                            </button>
                        </td><!--ボタン3-->
                        <td>
                            <button id="like-button4-{{ zatudan_log_data['id'] }}">
                                (';'){{ zatudan_log_data['like4'] }}
                            </button>
                        </td><!--ボタン4-->
                        <footer class="an-footer">
                            <td colspan="2">
                                <button style="float: right; margin-right: 5%;"><a href="{{ url_for('response') }}">返信</a></button></td><!--返信ボタン-->
                        </footer>
                    </tr>
                </tbody>
            </table>
        </p>

        <script>

            // 「いいね1」ボタンのelementを取得
            document.getElementById("like-button1-{{ zatudan_log_data['id'] }}").
                addEventListener("click", ev => {
    
                    // 「いいね」ボタンを無効化
                    document.getElementById("like-button1-{{ zatudan_log_data['id'] }}").disabled = true;
    
                    // バックエンドに「いいね」のカウントアップをリクエスト
                    fetch("zatulike1", {
                        method: "POST",
                        headers: { "Content-Type": "application/json; charset=utf-8" },
                        body: JSON.stringify({ "id": "{{ zatudan_log_data['id'] }}" })
                    })
                        .then(response => {
                            // カウントアップ後の「いいね」を取得
                            return response.json();
                        })
                        .then(data => {
                            // カウントアップ後の「いいね」を「いいね」ボタンに反映
                            document.getElementById("like-button1-{{ zatudan_log_data['id'] }}").innerHTML = '（’；’）' + data["result"];
                        }).finally(() => {
                            console.log("request complete!");
                        });
                });

                // 「いいね2」ボタンのelementを取得
            document.getElementById("like-button2-{{ zatudan_log_data['id'] }}").
                addEventListener("click", ev => {
    
                    // 「いいね」ボタンを無効化
                    document.getElementById("like-button2-{{ zatudan_log_data['id'] }}").disabled = true;
    
                    // バックエンドに「いいね」のカウントアップをリクエスト
                    fetch("zatulike2", {
                        method: "POST",
                        headers: { "Content-Type": "application/json; charset=utf-8" },
                        body: JSON.stringify({ "id": "{{ zatudan_log_data['id'] }}" })
                    })
                        .then(response => {
                            // カウントアップ後の「いいね」を取得
                            return response.json();
                        })
                        .then(data => {
                            // カウントアップ後の「いいね」を「いいね」ボタンに反映
                            document.getElementById("like-button2-{{ zatudan_log_data['id'] }}").innerHTML = '（’；’）' + data["result"];
                        }).finally(() => {
                            console.log("request complete!");
                        });
                });

                 // 「いいね3」ボタンのelementを取得
            document.getElementById("like-button3-{{ zatudan_log_data['id'] }}").
                addEventListener("click", ev => {
    
                    // 「いいね」ボタンを無効化
                    document.getElementById("like-button3-{{ zatudan_log_data['id'] }}").disabled = true;
    
                    // バックエンドに「いいね」のカウントアップをリクエスト
                    fetch("zatulike3", {
                        method: "POST",
                        headers: { "Content-Type": "application/json; charset=utf-8" },
                        body: JSON.stringify({ "id": "{{ zatudan_log_data['id'] }}" })
                    })
                        .then(response => {
                            // カウントアップ後の「いいね」を取得
                            return response.json();
                        })
                        .then(data => {
                            // カウントアップ後の「いいね」を「いいね」ボタンに反映
                            document.getElementById("like-button3-{{ zatudan_log_data['id'] }}").innerHTML = '（’；’）' + data["result"];
                        }).finally(() => {
                            console.log("request complete!");
                        });
                });

                 // 「いいね4」ボタンのelementを取得
            document.getElementById("like-button4-{{ zatudan_log_data['id'] }}").
                addEventListener("click", ev => {
    
                    // 「いいね」ボタンを無効化
                    document.getElementById("like-button4-{{ zatudan_log_data['id'] }}").disabled = true;
    
                    // バックエンドに「いいね」のカウントアップをリクエスト
                    fetch("zatulike4", {
                        method: "POST",
                        headers: { "Content-Type": "application/json; charset=utf-8" },
                        body: JSON.stringify({ "id": "{{ zatudan_log_data['id'] }}" })
                    })
                        .then(response => {
                            // カウントアップ後の「いいね」を取得
                            return response.json();
                        })
                        .then(data => {
                            // カウントアップ後の「いいね」を「いいね」ボタンに反映
                            document.getElementById("like-button4-{{ zatudan_log_data['id'] }}").innerHTML = '（’；’）' + data["result"];
                        }).finally(() => {
                            console.log("request complete!");
                        });
                });

        </script>
    
        {% endfor %}
</div>
<footer class="db-footer">
    <a href="{{ url_for('zatudan') }}" class="ask-question-btn">雑談する</a>
</footer>
<div class="push"></div>


{% include 'footer.html' %}

</body>
</html>